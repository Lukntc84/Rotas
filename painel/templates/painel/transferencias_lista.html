{% extends 'painel/base.html' %}

{% block header_title %}
  Painel de LogÃ­stica
{% endblock %}

{% block header_actions %}
  {% if perms.rotas.add_transferencia %}
    <a class="btn btn-primary" href="{% url 'painel:transferencia_nova' %}">+ Nova TransferÃªncia</a>
  {% endif %}
{% endblock %}

{% block content %}
  <div class="page-inner">
    <form method="POST" action="{% url 'painel:criar_rota_motorista' %}">
      {% csrf_token %}

      <div class="card">
        <div class="card-title">
          <h2>TransferÃªncias Pendentes</h2>
<div class="filter-group mb-3 d-flex flex-wrap gap-2">
    <a href="?tamanho=pequeno" class="btn btn-outline-info btn-sm">ðŸ“¦ Apenas Motoboy</a>
    <a href="?tamanho=grande" class="btn btn-outline-primary btn-sm">ðŸšš Cargas Grandes</a>
    <a href="{% url 'painel:transferencias_lista' %}" class="btn btn-link btn-sm text-danger">Limpar Filtros</a>
    
    <form method="GET" class="d-inline">
        <select name="loja" onchange="this.form.submit()" class="form-select form-select-sm d-inline-block w-auto">
            <option value="">Filtrar por Loja...</option>
            {% for loja in lojas %}
                <option value="{{ loja.id }}">{{ loja.nome }}</option>
            {% endfor %}
        </select>
    </form>
    
</div>

          {% if request.user.groups.all.0.name == 'Motoboy' or user.is_staff %}
            <button type="submit" class="btn btn-info" id="btn-criar-rota">Criar Rota com Selecionados</button>
          {% endif %}
        </div>

        <ul class="list">
          {% for t in transferencias %}
            <li class="list-item">
              <div style="display: flex; align-items: center; gap: 15px;">
                <input type="checkbox" name="transferencias_selecionadas" value="{{ t.id }}" style="width: 20px; height: 20px;" />

                <div>
                  <div class="userbox-name">{{ t.get_tipo_display }}</div>
                  <div class="small muted">{{ t.loja.nome }} â€¢ {{ t.loja.cidade }}</div>
                  <div class="small">
                    Status: <span class="badge">{{ t.status }}</span>
                  </div>
                </div>
              </div>

              <div class="actions">
                <a class="btn btn-ghost small" href="{% url 'painel:transferencia_detalhe' t.id %}">Detalhes</a>
              </div>
            </li>
          {% empty %}
            <li class="list-item">
              <span class="muted">Nenhuma transferÃªncia disponÃ­vel para rota.</span>
            </li>
          {% endfor %}
        </ul>
      </div>
    </form>
  </div>
{% endblock %}