{% extends 'painel/base.html' %}

{% block title %}
  Rotas de hoje
{% endblock %}
{% block header_title %}
  Painel de Rotas
{% endblock %}
{% block header_sub %}
  Hoje: {{ hoje }}
{% endblock %}

{% block header_actions %}
  {% if perms.rotas.add_rota %}
    <a class="btn btn-primary" href="{% url 'painel:criar_rota' %}">+ Nova rota</a>
  {% endif %}
  <a class="btn" href="{% url 'painel:home' %}">Início</a>
{% endblock %}

{% block content %}
  <div class="card">
    <div class="card-title">
      <h2>Rotas de hoje</h2>
      <span class="badge">{{ rotas|length }} rota(s)</span>
    </div>

    <ul class="list">
      {% for r in rotas %}
        <li class="list-item">
          <div>
            <a class="title-link" href="{% url 'painel:rota_detalhe' r.id %}">{{ r.nome|default:'Rota sem nome' }} #{{ r.id }}</a>
            <div class="small muted">Motoboy: {{ r.motoboy.username }}</div>

            <div class="small" style="margin-top: 5px;">
              {% if r.transferencias.all %}
                {% for t in r.transferencias.all %}
                  <strong style="color: var(--primary);">{{ t.loja_origem.nome }}</strong>
                  <span class="muted">→</span>
                  <strong>{{ t.loja_destino.nome }}</strong>
                  {% if not forloop.last %} | {% endif %}
                {% endfor %}
              {% else %}
                <span class="muted" style="color: #ef4444;">(Aguardando vinculação no banco)</span>
              {% endif %}
            </div>
          </div>

          <div class="actions">
            <a class="btn btn-primary" href="{% url 'painel:rota_detalhe' r.id %}">Abrir</a>
          </div>
        </li>
      {% endfor %}
    </ul>
  </div>
{% endblock %}
